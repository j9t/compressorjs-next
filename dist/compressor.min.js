/*!
 * Compressor.js v2.0.0
 * https://github.com/j9t/compressorjs-next
 *
 * Copyright 2018â€“2024 Chen Fengyuan
 * Copyright 2025 Jens Oliver Meiert
 *
 * Released under the MIT license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Compressor=t()}(this,function(){"use strict";function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},e.apply(null,arguments)}var t={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null};const i="undefined"!=typeof window&&void 0!==window.document?window:{},r=e=>e>0&&e<1/0,a=/^image\/.+$/;function n(e){return a.test(e)}const{fromCharCode:o}=String;const{btoa:s}=i;function h(e){const t=new DataView(e);let i;try{let e,r,a;if(255===t.getUint8(0)&&216===t.getUint8(1)){const e=t.byteLength;let i=2;for(;i+1<e;){if(255===t.getUint8(i)&&225===t.getUint8(i+1)){r=i;break}i+=1}}if(r){const i=r+10;if("Exif"===function(e,t,i){let r,a="";for(i+=t,r=t;r<i;r+=1)a+=o(e.getUint8(r));return a}(t,r+4,4)){const r=t.getUint16(i);if(e=18761===r,(e||19789===r)&&42===t.getUint16(i+2,e)){const r=t.getUint32(i+4,e);r>=8&&(a=i+r)}}}if(a){const r=t.getUint16(a,e);let n,o;for(o=0;o<r;o+=1)if(n=a+12*o+2,274===t.getUint16(n,e)){n+=8,i=t.getUint16(n,e),t.setUint16(n,1,e);break}}}catch{i=1}return i}const l=/\.\d*(?:0|9){12}\d*$/;function c(e,t=1e11){return l.test(e)?Math.round(e*t)/t:e}function d({aspectRatio:e,height:t,width:i},a="none"){const n=r(i),o=r(t);if(n&&o){const r=t*e;("contain"===a||"none"===a)&&r>i||"cover"===a&&r<i?t=i/e:i=t*e}else n?t=i/e:o&&(i=t*e);return{width:i,height:t}}const{ArrayBuffer:f,FileReader:u}=i,m=i.URL||i.webkitURL,g=/\.\w+$/;return class{constructor(e,i){this.file=e,this.exif=[],this.image=new Image,this.options={...t,...i},this.aborted=!1,this.result=null,this.init()}init(){const{file:t,options:i}=this;if(!(t instanceof Blob))return void this.fail(new Error("The first argument must be a File or Blob object."));const r=t.type;if(!n(r))return void this.fail(new Error("The first argument must be an image File or Blob object."));if(!m||!u)return void this.fail(new Error("The current browser does not support image compression."));f||(i.checkOrientation=!1,i.retainExif=!1);const a="image/jpeg"===r,l=a&&i.checkOrientation,c=a&&i.retainExif;if(!m||l||c){const i=new u;this.reader=i,i.onload=({target:i})=>{const{result:a}=i,n={};let d=1;l&&(d=h(a),d>1&&e(n,function(e){let t=0,i=1,r=1;switch(e){case 2:i=-1;break;case 3:t=-180;break;case 4:r=-1;break;case 5:t=90,r=-1;break;case 6:t=90;break;case 7:t=90,i=-1;break;case 8:t=-90}return{rotate:t,scaleX:i,scaleY:r}}(d))),c&&(this.exif=function(e){const t=Array.from(new Uint8Array(e)),{length:i}=t,r=[];let a=0;for(;a+3<i;){const e=t[a],i=t[a+1];if(255===e&&218===i)break;if(255===e&&216===i)a+=2;else{const e=a+(256*t[a+2]+t[a+3])+2,i=t.slice(a,e);r.push(i),a=e}}return r.reduce((e,t)=>255===t[0]&&225===t[1]?e.concat(t):e,[])}(a)),n.url=l||c?!m||d>1?function(e,t){const i=[];let r=new Uint8Array(e);for(;r.length>0;)i.push(o.apply(null,Array.from(r.subarray(0,8192)))),r=r.subarray(8192);return`data:${t};base64,${s(i.join(""))}`}(a,r):m.createObjectURL(t):a,this.load(n)},i.onabort=()=>{this.fail(new Error("Aborted to read the image with FileReader."))},i.onerror=()=>{this.fail(new Error("Failed to read the image with FileReader."))},i.onloadend=()=>{this.reader=null},l||c?i.readAsArrayBuffer(t):i.readAsDataURL(t)}else this.load({url:m.createObjectURL(t)})}load(e){const{file:t,image:r}=this;r.onload=()=>{this.draw({...e,naturalWidth:r.naturalWidth,naturalHeight:r.naturalHeight})},r.onabort=()=>{this.fail(new Error("Aborted to load the image."))},r.onerror=()=>{this.fail(new Error("Failed to load the image."))},i.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(i.navigator.userAgent)&&(r.crossOrigin="anonymous"),r.alt=t.name,r.src=e.url}draw({naturalWidth:e,naturalHeight:t,rotate:i=0,scaleX:a=1,scaleY:o=1}){const{file:s,image:h,options:l}=this,f=document.createElement("canvas"),m=f.getContext("2d"),g=Math.abs(i)%180==90,p=("contain"===l.resize||"cover"===l.resize)&&r(l.width)&&r(l.height);let w=Math.max(l.maxWidth,0)||1/0,b=Math.max(l.maxHeight,0)||1/0,y=Math.max(l.minWidth,0)||0,x=Math.max(l.minHeight,0)||0,v=e/t,{width:U,height:A}=l;g&&([w,b]=[b,w],[y,x]=[x,y],[U,A]=[A,U]),p&&(v=U/A),({width:w,height:b}=d({aspectRatio:v,width:w,height:b},"contain")),({width:y,height:x}=d({aspectRatio:v,width:y,height:x},"cover")),p?({width:U,height:A}=d({aspectRatio:v,width:U,height:A},l.resize)):({width:U=e,height:A=t}=d({aspectRatio:v,width:U,height:A})),U=Math.floor(c(Math.min(Math.max(U,y),w))),A=Math.floor(c(Math.min(Math.max(A,x),b)));const E=-U/2,R=-A/2,T=U,M=A,j=[];if(p){let i=0,r=0,a=e,n=t;({width:a,height:n}=d({aspectRatio:v,width:e,height:t},{contain:"cover",cover:"contain"}[l.resize])),i=(e-a)/2,r=(t-n)/2,j.push(i,r,a,n)}j.push(E,R,T,M),g&&([U,A]=[A,U]),f.width=U,f.height=A,n(l.mimeType)||(l.mimeType=s.type);let k="transparent";s.size>l.convertSize&&l.convertTypes.indexOf(l.mimeType)>=0&&(l.mimeType="image/jpeg");const B="image/jpeg"===l.mimeType;if(B&&(k="#fff"),m.fillStyle=k,m.fillRect(0,0,U,A),l.beforeDraw&&l.beforeDraw.call(this,m,f),this.aborted)return;if(m.save(),m.translate(U/2,A/2),m.rotate(i*Math.PI/180),m.scale(a,o),m.drawImage(h,...j),m.restore(),l.drew&&l.drew.call(this,m,f),this.aborted)return;f.toBlob(i=>{if(!this.aborted){const r=i=>this.done({naturalWidth:e,naturalHeight:t,result:i});if(i&&B&&l.retainExif&&this.exif&&this.exif.length>0){const e=e=>{const t=function(e,t){const i=Array.from(new Uint8Array(e));if(255!==i[2]||224!==i[3])return e;const r=256*i[4]+i[5],a=[255,216].concat(t,i.slice(4+r));return new Uint8Array(a)}(e,this.exif);var i,a;r((i=t,a=l.mimeType,new Blob([i],{type:a})))};if(i.arrayBuffer)i.arrayBuffer().then(e).catch(()=>{this.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{const t=new u;this.reader=t,t.onload=({target:t})=>{e(t.result)},t.onabort=()=>{this.fail(new Error("Aborted to read the compressed image with FileReader."))},t.onerror=()=>{this.fail(new Error("Failed to read the compressed image with FileReader."))},t.onloadend=()=>{this.reader=null},t.readAsArrayBuffer(i)}}else r(i)}},l.mimeType,l.quality)}done({naturalWidth:e,naturalHeight:t,result:i}){const{file:r,image:a,options:o}=this;if(m&&0===a.src.indexOf("blob:")&&m.revokeObjectURL(a.src),i)if(o.strict&&!o.retainExif&&i.size>r.size&&o.mimeType===r.type&&!(o.width>e||o.height>t||o.minWidth>e||o.minHeight>t||o.maxWidth<e||o.maxHeight<t))i=r;else{const e=new Date;i.lastModified=e.getTime(),i.lastModifiedDate=e,i.name=r.name,i.name&&i.type!==r.type&&(i.name=i.name.replace(g,function(e){let t=n(e)?e.substr(6):"";return"jpeg"===t&&(t="jpg"),`.${t}`}(i.type)))}else i=r;this.result=i,o.success&&o.success.call(this,i)}fail(e){const{options:t}=this;if(!t.error)throw e;t.error.call(this,e)}abort(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}static setDefaults(i){e(t,i)}}});
